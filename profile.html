<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classplay Profile</title>
    <link rel="shortcut icon" href="/img/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="/style.css">
    <script src="/main.js"></script>
    <link href="/assets/fontawesome/css/all.css" rel="stylesheet" />
</head>
<body>

    <style>

    </style>

    <nav>
        <ul>
            <li class="title"><a href="index.html" style="font-weight: 560;">Classplay</a></li>
            <li><a href="profile.html" class="lesspadding" style="margin-right: -30px;"><i class="fa-solid fa-user"></i></a></li>
            <li><a href="chat/"><i class="fa-solid fa-message"></i>Chatroom</a></li>
            <li><a href="movies/"><i class="fa-solid fa-tv"></i>Movies</a></li>
            <li><a href="p.html"><i class="fa-solid fa-search"></i>Search</a></li>
            <li><a href="s.html"><i class="fa-solid fa-music"></i>Sounds</a></li>
            <li><a href="apps.html"><i class="fa-solid fa-folder"></i>Apps</a></li>
            <li><a href="g.html"><i class="fa-solid fa-gamepad"></i>Games</a></li>
        </ul>   
    </nav>

<br><br><br><br>

    <center>
        <div id="register">
            <h1>Register an Account</h1>
            <input type="text" id="register-username" placeholder="Username"><br><br>
            <input type="password" id="register-password" placeholder="Password"><br><br>
            <button onclick="registerUser()">Register</button>
            <br><br><br>
            <p>Already have an account? <a onclick="displayLogin()">Login</a></p>
        </div>
    </center>
    
      <!-- Login Form -->
      <center>
        <div id="login" style="display: none;">
            <h1>Login to an Account</h1>
            <input type="text" id="login-username" placeholder="Username"><br><br>
            <input type="password" id="login-password" placeholder="Password"><br><br>
            <button onclick="registerUser()">Login</button>
            <br><br><br>
            <p>Need an account? <a onclick="displayRegister()">Register</a></p>
        </div>
    </center>
    
      <!-- Logout Button -->
      <div id="logout" style="display: none;">
        <h2>Welcome!</h2>
        <button onclick="logoutUser()">Logout</button>
      </div>
    
    
</body>
</html>





<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-analytics.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyCaQhCh3NMAZ9evrxGzx_ifbX_xJngifxU",
      authDomain: "classplay-login.firebaseapp.com",
      projectId: "classplay-login",
      storageBucket: "classplay-login.firebasestorage.app",
      messagingSenderId: "648989613074",
      appId: "1:648989613074:web:6f641d0b151712c7e48ccb",
      measurementId: "G-2F1WPF3JPK"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    // Register function
async function registerUser() {
    const username = document.getElementById('register-username').value;
    const password = document.getElementById('register-password').value;
    const pseudoEmail = `${username}@yourapp.com`;
  
    const usernameRef = db.collection("usernames").doc(username);
    const doc = await usernameRef.get();
  
    if (doc.exists) {
      alert("Username is already taken. Please choose another.");
      return;
    }
  
    auth.createUserWithEmailAndPassword(pseudoEmail, password)
      .then((userCredential) => {
        const user = userCredential.user;
  
        // Save username to Firestore
        usernameRef.set({ uid: user.uid });
        db.collection("users").doc(user.uid).set({ username: username, createdAt: new Date() });
  
        alert("Registration successful!");
        showLogout();
      })
      .catch((error) => {
        alert("Error during registration: " + error.message);
      });
  }
  
      
      // Login function
      function loginUser() {
        const username = document.getElementById('login-username').value;
        const password = document.getElementById('login-password').value;
        const pseudoEmail = `${username}@yourapp.com`;
      
        auth.signInWithEmailAndPassword(pseudoEmail, password)
          .then((userCredential) => {
            const user = userCredential.user;
            alert("Login successful!");
            showLogout();
          })
          .catch((error) => {
            alert("Error during login: " + error.message);
          });
      }
      
      // Logout function
      function logoutUser() {
        auth.signOut().then(() => {
          alert("You have been logged out successfully!");
          showLogin();
        }).catch((error) => {
          alert("Error during logout: " + error.message);
        });
      }
      
      // UI State Functions
      function showLogout() {
        document.getElementById('register').style.display = 'none';
        document.getElementById('login').style.display = 'none';
        document.getElementById('logout').style.display = 'block';
      }
      
      function showLogin() {
        document.getElementById('register').style.display = 'block';
        document.getElementById('login').style.display = 'block';
        document.getElementById('logout').style.display = 'none';
      }
      
      // Listen for auth state changes
      auth.onAuthStateChanged((user) => {
        if (user) {
          showLogout();
        } else {
          showLogin();
        }
      });
  </script>